class Invitation < ActiveRecord::Base
	has_one :address
	accepts_nested_attributes_for :address
	before_validation :generate_code
	validates_uniqueness_of :invite_code
	validates_presence_of :invite_code, :first_names, :last_name, :spots, :rsvp_number	

	def self.search(search)
	  if search
	   	where('last_name LIKE ?', "%#{search}%")
	  else
	    scoped
  	end
	end


	def generate_code
		if self.invite_code.blank?
			self.invite_code = 'l' + rand(9).to_s + 'o' + rand(9).to_s + 'v' + rand(9).to_s + 'e' 
		end
	end

	def change_address(params)
		if self.address.blank?
			self.build_address
		end

		@invitation.address.attributes = params[:address]
	end
end
